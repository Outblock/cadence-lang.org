# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Documentation and marketing site for the **Cadence** programming language (Flow blockchain). Built with TanStack Start + Fumadocs + Tailwind CSS v4, deployed on Vercel.

## Commands

```bash
npm run dev          # Dev server on port 3000
npm run build        # Production build + sitemap generation
npm run start        # Run built server (node .output/server/index.mjs)
npm run types:check  # TypeScript + MDX type checking (fumadocs-mdx && tsc --noEmit)

# MCP server (separate workspace in mcp-server/)
cd mcp-server
bun run build        # Build
bun test             # All tests
bun test:unit        # Unit tests only
bun test:integration # Integration tests (requires Flow CLI)
```

## Architecture

### Framework Stack
- **TanStack Start** — file-based routing with SSR via Nitro (Vercel preset)
- **Fumadocs** — MDX docs engine (`fumadocs-core`, `fumadocs-ui`, `fumadocs-mdx`)
- **Tailwind CSS v4** — styling via `@tailwindcss/vite` plugin (no separate config file)
- **@vercel/og** — server-side OG image generation (Satori + resvg-wasm)

### Key Directories
- `src/routes/` — TanStack Start file-based routes
- `src/routes/api/` — Server-only API endpoints (chat, search)
- `src/routes/og.*.tsx` — OG image generation routes (server handlers)
- `src/components/` — React components; `ui/` has shadcn-style primitives
- `src/lib/` — Utilities, Fumadocs source config, Cadence TextMate grammar
- `content/docs/` — All MDX documentation files
- `mcp-server/` — Standalone MCP server package (published to npm as `@outblock/cadence-mcp`)
- `skills/cadence/SKILL.md` — Compact AI skill reference, auto-updated by CI
- `.source/` — Auto-generated by Fumadocs (do not edit)

### Routing Patterns
- `docs/$.tsx` — catch-all route for doc pages via Fumadocs
- `og.docs.$.tsx` — dynamic OG images per doc page
- `llms.txt.ts` / `llms-full.txt.ts` — LLM-optimized doc endpoints
- Server-only handlers use `createFileRoute().server.handlers.GET/POST`
- `routeTree.gen.ts` is auto-generated; never edit manually

### Docs Content
- MDX files in `content/docs/` with YAML frontmatter (`title`, `description`, optional `icon`)
- Cadence syntax highlighting via custom TextMate grammar (`src/lib/cadence.tmLanguage.json`)
- Shiki dual themes: `github-light` (light mode) + `github-dark` (dark mode), controlled by CSS variables in `src/styles/app.css`
- Admonition types configured in `source.config.ts`: note, tip, info, warn, warning, danger, important, success
- Fumadocs source loader in `src/lib/source.ts`

### OG Images
- Generated at request time using `@vercel/og` (not pre-rendered)
- Satori **cannot render SVG `<path>` elements** — use PNG base64 data URIs for icons (`src/lib/og-icon.ts`)
- `VITE_SITE_URL` env var controls the domain in meta tags (defaults to `https://cadence-lang.org`)

### AI Chat
- `/api/chat` endpoint is server-only (`ANTHROPIC_API_KEY` never reaches client)
- Uses `ai` SDK with streaming; frontend uses `useChat` from `@ai-sdk/react`
- Search panel: `src/components/search.tsx` (Cmd+/ hotkey, draggable, localStorage persistence)

## Environment Variables

```bash
VITE_SITE_URL=https://cadence-lang.org  # OG/meta tag URLs (no trailing slash)
VITE_SKILLS_ORG=onflow                  # Homepage skills command org
VITE_GTAG=                              # Google Analytics (optional)
ANTHROPIC_API_KEY=                       # Server-only, for /api/chat
```

## Conventions

- Use `cn()` from `src/lib/cn.ts` for Tailwind class merging (clsx + tailwind-merge)
- Theme colors defined as CSS variables in `src/styles/app.css` (`--accent`, Fumadocs overrides)
- Dark mode uses `dark` class on `<html>` (Fumadocs convention)
- Nav links and layout options configured in `src/lib/layout.shared.tsx`
- Site URL centralized in `src/lib/site.ts` (strips trailing slashes)
